var e=Object.defineProperty,a=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,r=(a,t,l)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[t]=l;import{s as o,u as s,B as i,C as p,A as u,r as n,o as d,c,D as g,w as y,a as v,F as m,d as f,t as D,e as w,b}from"./vendor.7002d699.js";const F={name:"LeaveOperateDialog",props:{getLeaveList:{required:!0,type:Function},leaveTypeList:{required:!0,type:Array},applyStateList:{required:!0,type:Array}},setup(e){const{proxy:n}=u();return((e,o)=>{for(var s in o||(o={}))t.call(o,s)&&r(e,s,o[s]);if(a)for(var s of a(o))l.call(o,s)&&r(e,s,o[s]);return e})({},((e,a)=>{const t=o("$api"),l=s({_id:"",leaveType:0,leaveDate:[],leaveLength:0,reason:"",applyState:"",applyUser:{},auditFlows:[],currentFlow:0,currentFlowUser:{},auditLogs:[],remark:"",showDialog:!1,action:"",title:""}),r=i((()=>{var a;return null==(a=e.leaveTypeList.filter((e=>e.value===l.leaveType))[0])?void 0:a.label})),u=i((()=>{var a;return null==(a=e.applyStateList.filter((e=>e.value===l.applyState))[0])?void 0:a.label})),n=(a,t,r)=>{"view"!==t&&"edit"!==t||(l.action=t,l.title=("view"===t?"查看":"审核")+"休假申请"),l.showDialog=a,e.$nextTick((()=>{e.$refs.operateForm.resetFields(),a&&(l._id=r._id,l.leaveType=r.leaveType,l.leaveDate=r.leaveDate,l.leaveLength=r.leaveLength,l.reason=r.reason,l.applyState=r.applyState,l.applyUser=r.applyUser,l.auditFlows=r.auditFlows,l.currentFlow=r.currentFlow,l.currentFlowUser=r.currentFlowUser,l.auditLogs=r.auditLogs,l.remark=r.remark)}))};return{dialogData:l,dialogDataRules:{remark:{trigger:"blur",required:!0,message:"请输入审核备注"}},leaveTypeDesc:r,applyStateDesc:u,getStepInfo:e=>{const a={status:"wait",desc:u.value},t=l.auditLogs.filter((a=>a.userId===l.auditFlows[e].userId));return t.length>0?(a.desc=t[0].remark,a.status="reject"===t[0].action?"error":"success"):(l.applyState<3&&e===l.currentFlow&&(a.status="process"),l.applyState>3&&(a.status="error")),3===l.applyState&&(a.status="finish"),a},handleToggleDialogShow:n,handleSubmitApplyLeave:r=>{e.$refs.operateForm.validate((async o=>{if(o&&r){const{_id:o,remark:s}=p(l);!0===await t.leaveAudit({_id:o,remark:s,action:r})?(n(!1),a(),e.$message.success("提交审核 成功！"),t.getNoticeCount()):e.$message.warning("提交审核 失败！")}}))}}})(n,e.getLeaveList))}},L=b("驳 回"),h=b("批 准");F.render=function(e,a,t,l,r,o){const s=n("el-step"),i=n("el-steps"),p=n("el-form-item"),u=n("el-input"),b=n("el-form"),F=n("el-button"),S=n("el-dialog");return d(),c(S,{modelValue:e.dialogData.showDialog,"onUpdate:modelValue":a[4]||(a[4]=a=>e.dialogData.showDialog=a),title:e.dialogData.title},g({default:y((()=>[v(i,{active:e.dialogData.currentFlow},{default:y((()=>[(d(!0),c(m,null,f(e.dialogData.auditFlows,((a,t)=>(d(),c(s,{key:t,title:a.userName,status:e.getStepInfo(t).status,description:e.getStepInfo(t).desc},null,8,["title","status","description"])))),128))])),_:1},8,["active"]),v(b,{model:e.dialogData,rules:e.dialogDataRules,ref:"operateForm","label-position":"right","label-width":"6em"},{default:y((()=>[v(p,{label:"申请人:"},{default:y((()=>[v("span",null,D(e.dialogData.applyUser.userName),1)])),_:1}),v(p,{label:"休假类型:",prop:"leaveType"},{default:y((()=>[v("span",null,D(e.leaveTypeDesc),1)])),_:1}),v(p,{label:"休假时间:",prop:"leaveDate"},{default:y((()=>[v("span",null,D(e.dialogData.leaveDate.join(" 至 ")),1)])),_:1}),v(p,{label:"休假时长:",prop:"leaveLength"},{default:y((()=>[v("span",null,D(e.dialogData.leaveLength)+" 天",1)])),_:1}),v(p,{label:"休假原因:",prop:"reason"},{default:y((()=>[v("span",null,D(e.dialogData.reason),1)])),_:1}),v(p,{label:"审批状态:",prop:"auditFlows"},{default:y((()=>[v("span",null,D(e.applyStateDesc),1)])),_:1}),v(p,{label:"审核人:"},{default:y((()=>[v("span",null,D(e.dialogData.currentFlowUser.userName),1)])),_:1}),"edit"===e.dialogData.action?(d(),c(p,{key:0,label:"备注:",prop:"remark"},{default:y((()=>[v(u,{type:"textarea",modelValue:e.dialogData.remark,"onUpdate:modelValue":a[1]||(a[1]=a=>e.dialogData.remark=a),placeholder:"请输入备注信息",autocomplete:"off"},null,8,["modelValue"])])),_:1})):w("",!0)])),_:1},8,["model","rules"])])),_:2},["edit"===e.dialogData.action?{name:"footer",fn:y((()=>[v(F,{type:"danger",onClick:a[2]||(a[2]=a=>e.handleSubmitApplyLeave("reject"))},{default:y((()=>[L])),_:1}),v(F,{type:"primary",onClick:a[3]||(a[3]=a=>e.handleSubmitApplyLeave("approve"))},{default:y((()=>[h])),_:1})]))}:void 0]),1032,["modelValue","title"])};export default F;
