var e=Object.defineProperty,a=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,t=Object.prototype.propertyIsEnumerable,r=(a,l,t)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[l]=t,o=(e,o)=>{for(var i in o||(o={}))l.call(o,i)&&r(e,i,o[i]);if(a)for(var i of a(o))t.call(o,i)&&r(e,i,o[i]);return e};import{u as i}from"./index.a8eae04d.js";import n from"./RoleOperateDialog.05035593.js";import{s,v as p,u,x as m,r as d,y as g,o as c,c as f,a as b,w as y,z as h,F as _,d as D,A as w,b as z}from"./vendor.7002d699.js";const S=e=>{const a=s("$api"),l=[{label:"角色名称",prop:"roleName"},{label:"备注",prop:"remark"},{label:"权限列表",prop:"rolePermission",formatter(e,a,l){const t=(e=[],a,l=[])=>{e.forEach((e=>{a.indexOf(e._id)>-1&&l.push(e.menuName),e.children&&e.children.length&&t(e.children,a,l)}))},r=[];return l&&l.checkedPages&&t(g.value,l.checkedPages,r),r.join(",").replace(/,$/,"")}},{label:"更新时间",prop:"updateTime",formatter:(e,a,l)=>i.formatterDateTime(l),width:90}],t=p([]),r=u({roleName:""}),n=u({pageNum:1,pageSize:10,total:0}),d=async()=>{const e=o(o({},n),r),{page:l,list:i}=await a.getRoleList(e);l&&i&&(t.value=i,n.total=l.total)},g=p([]);return m((()=>{d(),(async()=>{const e=await a.getMenuList();e&&(g.value=e)})()})),{tableColumns:l,roleList:t,query:r,pageData:n,menuList:g,getRoleList:d,handleQuerySubmit:a=>{const{reset:l,pageNum:t,pageSize:r}=a;l&&e.$refs.queryForm.resetFields(),n.pageNum=t||1,n.pageSize=r||10,d()},showDialog:(a,l,t)=>{e.$refs.roleOperateDialog.handleToggleDialogShow(a,l,t)},handleSingleDel:async l=>{if(l&&l._id){!0===await a.roleOperate({_id:l._id,roleName:l.roleName,action:"delete"})?(e.$message.success("删除成功！"),d()):e.$message.error("删除失败！")}}}},k={name:"Role",components:{RoleOperateDialog:n},setup(){const{proxy:e}=w();return o({},S(e))}},v={class:"content_wrapper"},C={class:"query_form_wrapper"},N=z("查询"),O=z(" 重置 "),L={class:"table_container"},j={class:"table_tools"},R=z(" 新增 "),P={class:"table_content"},q=z("编辑"),x=z("设置权限"),$=z("删除");k.render=function(e,a,l,t,r,o){const i=d("el-input"),n=d("el-form-item"),s=d("el-button"),p=d("el-form"),u=d("el-table-column"),m=d("el-table"),w=d("el-pagination"),z=d("RoleOperateDialog"),S=g("has");return c(),f("div",v,[b("div",C,[b(p,{inline:!0,model:e.query,ref:"queryForm"},{default:y((()=>[b(n,{label:"角色名称",prop:"roleName"},{default:y((()=>[b(i,{modelValue:e.query.roleName,"onUpdate:modelValue":a[1]||(a[1]=a=>e.query.roleName=a),placeholder:"请输入角色名称"},null,8,["modelValue"])])),_:1}),b(n,null,{default:y((()=>[b(s,{type:"primary",onClick:e.handleQuerySubmit},{default:y((()=>[N])),_:1},8,["onClick"]),b(s,{onClick:a[2]||(a[2]=a=>e.handleQuerySubmit({reset:!0}))},{default:y((()=>[O])),_:1})])),_:1})])),_:1},8,["model"])]),b("div",L,[b("div",j,[h(b(s,{type:"primary",onClick:a[3]||(a[3]=a=>e.showDialog(!0,"add"))},{default:y((()=>[R])),_:1},512),[[S,"role-add"]])]),b("div",P,[b(m,{data:e.roleList,stripe:""},{default:y((()=>[(c(!0),f(_,null,D(e.tableColumns,(e=>(c(),f(u,{key:e.prop,prop:e.prop,label:e.label,formatter:e.formatter},null,8,["prop","label","formatter"])))),128)),b(u,{label:"操作"},{default:y((a=>[h(b(s,{size:"mini",onClick:l=>e.showDialog(!0,"edit",a.row)},{default:y((()=>[q])),_:2},1032,["onClick"]),[[S,"role-edit"]]),h(b(s,{size:"mini",type:"primary",onClick:l=>e.showDialog(!0,"setPermission",a.row)},{default:y((()=>[x])),_:2},1032,["onClick"]),[[S,"role-setPermission"]]),h(b(s,{size:"mini",type:"danger",onClick:l=>e.handleSingleDel(a.row)},{default:y((()=>[$])),_:2},1032,["onClick"]),[[S,"role-delete"]])])),_:1})])),_:1},8,["data"]),b(w,{onSizeChange:a[4]||(a[4]=a=>{e.handleQuerySubmit({pageSize:a})}),onCurrentChange:a[5]||(a[5]=a=>{e.handleQuerySubmit({pageNum:a})}),"current-page":e.pageData.pageNum,"onUpdate:current-page":a[6]||(a[6]=a=>e.pageData.pageNum=a),"page-sizes":[10,20,50,100],"page-size":e.pageData.pageSize,"onUpdate:page-size":a[7]||(a[7]=a=>e.pageData.pageSize=a),total:e.pageData.total,class:"table_pagination",layout:"total, sizes, prev, pager, next, jumper",background:""},null,8,["current-page","page-size","total"])])]),b(z,{ref:"roleOperateDialog",getRoleList:e.getRoleList,menuList:e.menuList},null,8,["getRoleList","menuList"])])};export default k;
