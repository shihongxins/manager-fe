var e=Object.defineProperty,a=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,r=(a,t,l)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[t]=l;import{s as o,A as s,B as i,z as p,r as u,o as n,c as d,C as c,w as g,a as y,F as v,d as m,t as f,e as D,b as w}from"./vendor.9586058d.js";const b={name:"LeaveOperateDialog",props:{getLeaveList:{required:!0,type:Function},leaveTypeList:{required:!0,type:Array},applyStateList:{required:!0,type:Array}},setup(e){const{ctx:u}=p();return((e,o)=>{for(var s in o||(o={}))t.call(o,s)&&r(e,s,o[s]);if(a)for(var s of a(o))l.call(o,s)&&r(e,s,o[s]);return e})({},((e,a)=>{const t=o({_id:"",leaveType:0,leaveDate:[],leaveLength:0,reason:"",applyState:"",applyUser:{},auditFlows:[],currentFlow:0,currentFlowUser:{},auditLogs:[],remark:"",showDialog:!1,action:"",title:""}),l=s((()=>{var a;return null==(a=e.leaveTypeList.filter((e=>e.value===t.leaveType))[0])?void 0:a.label})),r=s((()=>{var a;return null==(a=e.applyStateList.filter((e=>e.value===t.applyState))[0])?void 0:a.label})),p=(a,l,r)=>{"view"!==l&&"edit"!==l||(t.action=l,t.title=("view"===l?"查看":"审核")+"休假申请"),t.showDialog=a,e.$nextTick((()=>{e.$refs.operateForm.resetFields(),a&&(t._id=r._id,t.leaveType=r.leaveType,t.leaveDate=r.leaveDate,t.leaveLength=r.leaveLength,t.reason=r.reason,t.applyState=r.applyState,t.applyUser=r.applyUser,t.auditFlows=r.auditFlows,t.currentFlow=r.currentFlow,t.currentFlowUser=r.currentFlowUser,t.auditLogs=r.auditLogs,t.remark=r.remark)}))};return{dialogData:t,dialogDataRules:{remark:{trigger:"blur",required:!0,message:"请输入审核备注"}},leaveTypeDesc:l,applyStateDesc:r,getStepInfo:e=>{const a={status:"wait",desc:r.value},l=t.auditLogs.filter((a=>a.userId===t.auditFlows[e].userId));return l.length>0?(a.desc=l[0].remark,a.status="reject"===l[0].action?"error":"success"):(t.applyState<3&&e===t.currentFlow&&(a.status="process"),t.applyState>3&&(a.status="error")),3===t.applyState&&(a.status="finish"),a},handleToggleDialogShow:p,handleSubmitApplyLeave:l=>{e.$refs.operateForm.validate((async r=>{if(r&&l){const{_id:r,remark:o}=i(t);!0===await e.$api.leaveAudit({_id:r,remark:o,action:l})?(p(!1),a(),e.$message.success("提交审核 成功！"),e.$api.getNoticeCount()):e.$message.warning("提交审核 失败！")}}))}}})(u,e.getLeaveList))}},F=w("驳 回"),L=w("批 准");b.render=function(e,a,t,l,r,o){const s=u("el-step"),i=u("el-steps"),p=u("el-form-item"),w=u("el-input"),b=u("el-form"),h=u("el-button"),S=u("el-dialog");return n(),d(S,{modelValue:e.dialogData.showDialog,"onUpdate:modelValue":a[4]||(a[4]=a=>e.dialogData.showDialog=a),title:e.dialogData.title},c({default:g((()=>[y(i,{active:e.dialogData.currentFlow},{default:g((()=>[(n(!0),d(v,null,m(e.dialogData.auditFlows,((a,t)=>(n(),d(s,{key:t,title:a.userName,status:e.getStepInfo(t).status,description:e.getStepInfo(t).desc},null,8,["title","status","description"])))),128))])),_:1},8,["active"]),y(b,{model:e.dialogData,rules:e.dialogDataRules,ref:"operateForm","label-position":"right","label-width":"6em"},{default:g((()=>[y(p,{label:"申请人:"},{default:g((()=>[y("span",null,f(e.dialogData.applyUser.userName),1)])),_:1}),y(p,{label:"休假类型:",prop:"leaveType"},{default:g((()=>[y("span",null,f(e.leaveTypeDesc),1)])),_:1}),y(p,{label:"休假时间:",prop:"leaveDate"},{default:g((()=>[y("span",null,f(e.dialogData.leaveDate.join(" 至 ")),1)])),_:1}),y(p,{label:"休假时长:",prop:"leaveLength"},{default:g((()=>[y("span",null,f(e.dialogData.leaveLength)+" 天",1)])),_:1}),y(p,{label:"休假原因:",prop:"reason"},{default:g((()=>[y("span",null,f(e.dialogData.reason),1)])),_:1}),y(p,{label:"审批状态:",prop:"auditFlows"},{default:g((()=>[y("span",null,f(e.applyStateDesc),1)])),_:1}),y(p,{label:"审核人:"},{default:g((()=>[y("span",null,f(e.dialogData.currentFlowUser.userName),1)])),_:1}),"edit"===e.dialogData.action?(n(),d(p,{key:0,label:"备注:",prop:"remark"},{default:g((()=>[y(w,{type:"textarea",modelValue:e.dialogData.remark,"onUpdate:modelValue":a[1]||(a[1]=a=>e.dialogData.remark=a),placeholder:"请输入备注信息",autocomplete:"off"},null,8,["modelValue"])])),_:1})):D("",!0)])),_:1},8,["model","rules"])])),_:2},["edit"===e.dialogData.action?{name:"footer",fn:g((()=>[y(h,{type:"danger",onClick:a[2]||(a[2]=a=>e.handleSubmitApplyLeave("reject"))},{default:g((()=>[F])),_:1}),y(h,{type:"primary",onClick:a[3]||(a[3]=a=>e.handleSubmitApplyLeave("approve"))},{default:g((()=>[L])),_:1})]))}:void 0]),1032,["modelValue","title"])};export default b;
